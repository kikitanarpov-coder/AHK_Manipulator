# –≠–∫—Å–ø–æ—Ä—Ç –∏ –ò–º–ø–æ—Ä—Ç –≤ AHK Manipulator

## üì§ –≠–∫—Å–ø–æ—Ä—Ç

### –≠–∫—Å–ø–æ—Ä—Ç –≤ AHK

```python
from backend import BackendApplication

backend = BackendApplication(...)
board = backend.create_board("Test")

# –≠–∫—Å–ø–æ—Ä—Ç –≤ AHK —Å–∫—Ä–∏–ø—Ç
ahk_script = backend.export_to_ahk(board)
print(ahk_script)

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ñ–∞–π–ª
with open("script.ahk", "w") as f:
    f.write(ahk_script)
```

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```ahk
; AHK Script generated by AHK Manipulator
; Board: Test
; Generated: 2026-02-18 20:00:00

#Requires AutoHotkey v2.0
#SingleInstance Force

F1:: ; –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
    RunScript()
    return

F2:: ; –û—Å—Ç–∞–Ω–æ–≤–∫–∞
    ExitApp
    return

; ===== Main Script =====
RunScript() {
; Row: –î–µ–π—Å—Ç–≤–∏–µ 1
Click, left, 100, 200
Sleep, 1000
MouseMove, 300, 400
Send, {Enter}
}
```

### –≠–∫—Å–ø–æ—Ä—Ç –≤ Python

```python
# –≠–∫—Å–ø–æ—Ä—Ç –≤ Python —Å–∫—Ä–∏–ø—Ç
python_script = backend.export_to_python(board)
print(python_script)
```

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
```python
# Python Script generated by AHK Manipulator
import asyncio
from backend import BackendApplication, MouseService, KeyboardService

async def run_board():
    backend = BackendApplication(
        mouse=MouseService(),
        keyboard=KeyboardService()
    )
    
    # Row: –î–µ–π—Å—Ç–≤–∏–µ 1
    backend.mouse.click(x=100, y=200, button='left')
    await asyncio.sleep(1000 / 1000)
    backend.mouse.move_to(x=300, y=400)
    backend.keyboard.press('enter')

if __name__ == '__main__':
    asyncio.run(run_board())
```

### –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON

```python
# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–æ—Å–∫–∏
backend.save_board(board, "board.json")

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä
from backend.export import ActionExporter

exporter = ActionExporter()
json_data = exporter.export_to_json(board)
```

---

## üì• –ò–º–ø–æ—Ä—Ç

### –ò–º–ø–æ—Ä—Ç –∏–∑ AHK

```python
from backend import BackendApplication

backend = BackendApplication(...)

# –ò–º–ø–æ—Ä—Ç –∏–∑ —Å—Ç—Ä–æ–∫–∏
ahk_text = """
Click, left, 100, 200
Sleep, 1000
Send, {Enter}
"""

board = backend.import_from_ahk(ahk_text, "Imported Board")
backend.current_board = board
```

### –ò–º–ø–æ—Ä—Ç –∏–∑ —Ñ–∞–π–ª–∞

```python
# –ò–º–ø–æ—Ä—Ç –∏–∑ AHK —Ñ–∞–π–ª–∞
board = backend.import_from_file("script.ahk")

# –ò–º–ø–æ—Ä—Ç –∏–∑ JSON —Ñ–∞–π–ª–∞
board = backend.import_from_file("board.json")

backend.current_board = board
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ AHK –∫–æ–º–∞–Ω–¥—ã

| AHK –ö–æ–º–∞–Ω–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã |
|-------------|----------|-----------|
| `Click, btn, x, y` | MOUSE_CLICK | button, x, y |
| `MouseMove, x, y` | MOUSE_MOVE | x, y |
| `Send, {key}` | KEY_PRESS | key |
| `Sleep, ms` | WAIT_TIME | delay_ms |
| `Loop, count` | LOOP | iterations |

---

## üéØ –®–∞–±–ª–æ–Ω—ã –¥–µ–π—Å—Ç–≤–∏–π

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —à–∞–±–ª–æ–Ω—ã

–ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –º–∞–ø–ø–∏—Ç—Å—è –Ω–∞ —à–∞–±–ª–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é:

```python
# backend/export.py
ACTION_TEMPLATES = {
    ActionType.MOUSE_CLICK: "Click, {button}, {x}, {y}",
    ActionType.KEY_PRESS: "Send, {{{key}}}",
    ActionType.WAIT_TIME: "Sleep, {ms}",
}
```

–ü—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ:
1. –ë–µ—Ä—ë—Ç—Å—è —à–∞–±–ª–æ–Ω –¥–ª—è —Ç–∏–ø–∞ –¥–µ–π—Å—Ç–≤–∏—è
2. –ü–æ–¥—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ `action.metadata`
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞ –∫–æ–¥–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞

```python
# 1. –î–æ–±–∞–≤–∏—Ç—å —à–∞–±–ª–æ–Ω –≤ —ç–∫—Å–ø–æ—Ä—Ç
AHK_TEMPLATES = {
    ActionType.MOUSE_CLICK: "Click, {button}, {x}, {y}",
    ActionType.MY_ACTION: "MyCommand, {param1}, {param2}",  # –ù–æ–≤—ã–π
}

# 2. –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
AHK_PATTERNS = {
    ActionType.MY_ACTION: r'MyCommand,\s*(\w+),\s*(\w+)',  # –ù–æ–≤—ã–π
}

# 3. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤ _parse_ahk_line
elif action_type == ActionType.MY_ACTION:
    return Action(
        id=str(uuid.uuid4()),
        action_type=action_type,
        name="My Action",
        metadata={
            "param1": groups[0],
            "param2": groups[1]
        }
    )
```

---

## üîÑ –ö—Ä—É–≥–æ–≤–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ

```
AHK Script
    ‚Üì (import_from_ahk)
TaskBoard (–≤ –ø–∞–º—è—Ç–∏)
    ‚Üì (export_to_ahk)
AHK Script
```

**–ü—Ä–∏–º–µ—Ä:**
```python
# 1. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑ AHK
board = backend.import_from_file("original.ahk")

# 2. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ UI
# ... –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç ...

# 3. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞—Ç–Ω–æ
ahk = backend.export_to_ahk(board)
with open("modified.ahk", "w") as f:
    f.write(ahk)
```

---

## üß™ –¢–µ—Å—Ç—ã

```python
import unittest
from backend import BackendApplication, ActionExporter, ActionImporter

class TestExportImport(unittest.TestCase):
    def test_export_to_ahk(self):
        backend = BackendApplication()
        board = backend.create_board("Test")
        
        ahk = backend.export_to_ahk(board)
        self.assertIn("AHK Manipulator", ahk)
    
    def test_import_from_ahk(self):
        backend = BackendApplication()
        
        ahk = "Click, left, 100, 200"
        board = backend.import_from_ahk(ahk)
        
        self.assertEqual(len(board.rows[0].actions), 1)
        self.assertEqual(board.rows[0].actions[0].coordinates.x, 100)
    
    def test_round_trip(self):
        backend = BackendApplication()
        board = backend.create_board("Test")
        
        # –≠–∫—Å–ø–æ—Ä—Ç ‚Üí –ò–º–ø–æ—Ä—Ç ‚Üí –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
        ahk = backend.export_to_ahk(board)
        imported = backend.import_from_ahk(ahk)
        
        self.assertEqual(
            len(board.rows[0].actions),
            len(imported.rows[0].actions)
        )

if __name__ == '__main__':
    unittest.main()
```

---

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–≠–∫—Å–ø–æ—Ä—Ç –≤ AHK** ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç standalone —Å–∫—Ä–∏–ø—Ç—ã
2. **–ò–º–ø–æ—Ä—Ç –∏–∑ AHK** ‚Äî –ø–∞—Ä—Å–∏—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
3. **JSON** ‚Äî –ø–æ–ª–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–∑–∞–≥—Ä—É–∑–∫–∏
4. **Python** ‚Äî –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–µ–∑ AHK
